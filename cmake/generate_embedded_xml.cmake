# CMake script to embed common.xml as a C++ string constant
# Usage: cmake -DXML_SOURCE_PATH=<path> -DOUTPUT_HEADER=<path> -P generate_embedded_xml.cmake

if(NOT XML_SOURCE_PATH)
    message(FATAL_ERROR "XML_SOURCE_PATH must be specified")
endif()

if(NOT OUTPUT_HEADER)
    message(FATAL_ERROR "OUTPUT_HEADER must be specified")
endif()

# Read the XML file
if(NOT EXISTS "${XML_SOURCE_PATH}")
    message(FATAL_ERROR "XML file not found: ${XML_SOURCE_PATH}")
endif()

file(READ "${XML_SOURCE_PATH}" XML_CONTENT)

# Escape the XML content for C++ string literal
string(REPLACE "\\" "\\\\" XML_CONTENT "${XML_CONTENT}")
string(REPLACE "\"" "\\\"" XML_CONTENT "${XML_CONTENT}")
string(REPLACE "\n" "\\n\"\n    \"" XML_CONTENT "${XML_CONTENT}")

# Generate the header file content
set(HEADER_CONTENT
"// This file is auto-generated by generate_embedded_xml.cmake
// Do not edit manually

#pragma once

namespace mav_embedded {
    const char* COMMON_XML = 
    \"${XML_CONTENT}\";
}
")

# Write the header file
file(WRITE "${OUTPUT_HEADER}" "${HEADER_CONTENT}")

message(STATUS "Generated embedded XML header: ${OUTPUT_HEADER}")